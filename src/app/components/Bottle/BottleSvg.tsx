import {AnimationDefinition, motion, useAnimate } from "framer-motion"
import { DOMAttributes, SVGProps, useEffect, useState } from "react"

export type BottleSvgProps = {
    angle: number,
    flip: boolean,
    duration: number,
} & SVGProps<SVGSVGElement> & DOMAttributes<SVGSVGElement>
 
const BottleSvg = ({angle, flip, duration, ...props}: BottleSvgProps) => {

    const [mouseTouched, setMouseTouched] = useState(false);

    const [animationPlaying, setAnimationPlaying] = useState(false);

    const [scope, animate] = useAnimate();
      
    const toggleAnimationPlaying = (animation: AnimationDefinition, animationPlaying: boolean) => {
        if (animation === "hover") {
            setAnimationPlaying(animationPlaying)
        }
    }


    useEffect(() => {
        if (scope.current) {
            animate(scope.current, {y: 0, opacity: 1}, {duration : 1});

            animate(scope.current, {name: "bobbing", y: [0, 40, 0]}, {
                times: [0, 1],
                duration: duration,
                repeat: Infinity,
                type: "keyframes",
                ease: "easeOut", })
        }
        
      
    // eslint-disable-next-line react-hooks/exhaustive-deps
    }, [])

    const variants = {
        bobbing: {y: [0, 40, 0], transition: {
            times: [0, 1],
            duration: duration,
            repeat: Infinity,
            type: "keyframes",
            ease: "easeOut",
        }},
        hover: {y: 0, transition: {duration: 0.3}}
    }
    

    return (
        <svg
            viewBox="0 0 97 280"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
            overflow={"visible"}
            {...props}>

            <motion.g 
                id="MessageInaBottle"
                variants={variants}
                ref={scope}

                initial={{rotate: angle, scaleX: flip ? -1 : 1, opacity: 0}}
                animate={(mouseTouched || animationPlaying) ? "hover" :  "bobbing"}
                exit={{y: 100, opacity: 0, transition: {duration: 1}}}

                whileTap={{}}

                onMouseEnter={() => setMouseTouched(true)}
                onMouseLeave={() => setMouseTouched(false)}

                onAnimationStart={(e) => toggleAnimationPlaying(e, true)}
                onAnimationComplete={(e) => toggleAnimationPlaying(e, false)}

                cursor={"pointer"}
                pointerEvents='all'>
                    
                <g id="Message">
                    <path
                    id="Polygon 2"
                    d="M45.5618 102.796L37.6558 174.062L58.6888 178.791L82.0458 110.999L45.5618 102.796ZM58.0307 181.717L36.9977 176.989L13.3352 245.668C17.6542 252.122 22.5043 255.916 28.291 257.272C34.1287 258.64 41.1894 257.592 50.0358 253.787L58.0307 181.717Z"
                    fill="#CA9C67"
                    stroke="#5C2806"
                    strokeWidth={3}
                    />
                    <path
                    id="Rectangle 3"
                    d="M59.1108 178.748C58.487 178.614 57.7179 178.448 56.8428 178.262C54.4457 177.752 51.2568 177.085 48.0839 176.46C44.9053 175.834 41.7647 175.253 39.4558 174.909C38.6572 174.791 37.9811 174.704 37.4481 174.653C37.4449 174.674 37.4418 174.695 37.4385 174.715C37.351 175.272 37.1901 175.829 37.0278 176.302L58.5306 180.74L58.72 179.793L58.747 179.658L58.7982 179.53L59.1108 178.748Z"
                    fill="#FE0707"
                    stroke="#FF0303"
                    strokeWidth={3}
                    />
                    <g id="Group 2">
                    <path
                        id="Ellipse 2"
                        d="M45.4565 101.149C45.4487 101.183 45.4046 101.556 46.1611 102.352C46.8716 103.099 48.0519 103.953 49.6867 104.84C52.9372 106.602 57.6763 108.325 63.1263 109.551C68.5764 110.776 73.5972 111.247 77.2892 111.045C79.1459 110.944 80.5783 110.677 81.5403 110.306C82.5644 109.911 82.6841 109.555 82.6919 109.52C82.6996 109.486 82.7438 109.113 81.9873 108.317C81.2768 107.57 80.0964 106.716 78.4617 105.83C75.2112 104.067 70.4721 102.344 65.022 101.118C59.572 99.8932 54.5512 99.4226 50.8592 99.624C49.0025 99.7252 47.57 99.9922 46.6081 100.363C45.584 100.759 45.4642 101.114 45.4565 101.149Z"
                        fill="#D1B798"
                        stroke="#5C2806"
                        strokeWidth={3}
                    />
                    <path
                        id="Vector"
                        d="M65.3668 107.26C65.9237 107.395 66.4888 107.523 67.0623 107.644C67.6429 107.749 68.2221 107.845 68.7999 107.931C69.3648 107.996 69.9182 108.05 70.4599 108.093C70.9683 108.111 71.4551 108.116 71.9202 108.109C72.3325 108.076 72.714 108.029 73.0647 107.969C73.3457 107.883 73.5883 107.784 73.7926 107.672C73.9142 107.535 73.9921 107.387 74.0263 107.227C73.9699 107.046 73.8673 106.856 73.7185 106.657C73.4769 106.441 73.1896 106.22 72.8566 105.992C72.4352 105.754 71.9719 105.514 71.4665 105.271C70.8834 105.027 70.2652 104.784 69.6119 104.542C68.8974 104.307 68.1574 104.077 67.392 103.852C66.5871 103.642 65.7687 103.442 64.9367 103.251C64.0907 103.082 63.2447 102.926 62.3985 102.783C61.5662 102.669 60.7479 102.57 59.9436 102.487C59.1814 102.438 58.447 102.406 57.7406 102.392C57.1029 102.414 56.5057 102.455 55.949 102.514C55.4844 102.609 55.0708 102.723 54.7082 102.855C54.4559 103.021 54.2621 103.203 54.1268 103.402C54.1134 103.632 54.1625 103.874 54.2739 104.131C54.5112 104.41 54.8108 104.7 55.1728 104.999C55.6562 105.313 56.1977 105.632 56.7972 105.956C57.5056 106.285 58.2636 106.614 59.0714 106.943C59.9676 107.266 60.9014 107.583 61.8731 107.895C62.9058 108.191 63.9614 108.475 65.0397 108.749C66.1468 108.997 67.2595 109.229 68.378 109.445C69.4897 109.626 70.589 109.788 71.6758 109.931C72.7194 110.031 73.7326 110.109 74.7153 110.165C75.6199 110.175 76.4773 110.162 77.2876 110.125C77.9887 110.04 78.6285 109.932 79.2069 109.801C79.6512 109.624 80.0234 109.425 80.3238 109.205C80.4727 108.943 80.5435 108.664 80.536 108.365C80.3695 108.033 80.1233 107.688 79.7976 107.328C79.3153 106.945 78.7572 106.554 78.1233 106.154C77.3457 105.743 76.5011 105.33 75.5898 104.914C74.5573 104.501 73.4716 104.093 72.3327 103.688C71.1039 103.3 69.8395 102.922 68.5393 102.556C67.1876 102.217 65.8207 101.897 64.4385 101.593C63.0475 101.329 61.6634 101.087 60.2861 100.868C58.9448 100.697 57.6327 100.553 56.3497 100.435C55.1465 100.372 53.9936 100.338 52.8909 100.332C51.908 100.384 50.9938 100.465 50.1484 100.575C49.456 100.742 48.8469 100.937 48.3211 101.159C47.9727 101.434 47.7172 101.733 47.5545 102.057C47.5829 102.425 47.7078 102.812 47.9295 103.219C48.3436 103.659 48.852 104.112 49.4548 104.579C50.2391 105.065 51.1091 105.556 52.0649 106.054C53.1793 106.556 54.365 107.055 55.6222 107.553C57.004 108.038 58.4378 108.513 59.9236 108.979C61.4911 109.416 63.0874 109.836 64.7125 110.238"
                        stroke="#351703"
                    />
                    </g>
                </g>
                <g id="Union">
                    <mask id="path-5-inside-1_60_2" fill="white">
                    <path
                        fillRule="evenodd"
                        clipRule="evenodd"
                        d="M35.9611 0C33.4632 0 31.4382 2.02496 31.4382 4.52288C31.4382 7.0208 33.4632 9.04576 35.9611 9.04576H36.3359C34.706 23.7454 29.3339 69.8482 24.9292 80.7079C10.7755 83.1174 0 95.4409 0 110.281L0 264.288C0 272.572 6.71571 279.288 15 279.288L81.1112 279.288C89.3955 279.288 96.1112 272.572 96.1112 264.288L96.1112 110.281C96.1112 95.3543 85.2097 82.9737 70.9341 80.6668C66.0615 69.7263 61.1762 23.6769 59.7193 9.0219C61.9976 8.78799 63.7747 6.86297 63.7747 4.52288C63.7747 2.02496 61.7498 0 59.2518 0L35.9611 0Z"
                    />
                    </mask>
                    <path
                    fillRule="evenodd"
                    clipRule="evenodd"
                    d="M35.9611 0C33.4632 0 31.4382 2.02496 31.4382 4.52288C31.4382 7.0208 33.4632 9.04576 35.9611 9.04576H36.3359C34.706 23.7454 29.3339 69.8482 24.9292 80.7079C10.7755 83.1174 0 95.4409 0 110.281L0 264.288C0 272.572 6.71571 279.288 15 279.288L81.1112 279.288C89.3955 279.288 96.1112 272.572 96.1112 264.288L96.1112 110.281C96.1112 95.3543 85.2097 82.9737 70.9341 80.6668C66.0615 69.7263 61.1762 23.6769 59.7193 9.0219C61.9976 8.78799 63.7747 6.86297 63.7747 4.52288C63.7747 2.02496 61.7498 0 59.2518 0L35.9611 0Z"
                    fill="url(#paint0_linear_60_2)"
                    fillOpacity={0.3}
                    />
                    <path
                    d="M36.3359 9.04576L39.3176 9.37638L39.6869 6.04576H36.3359V9.04576ZM24.9292 80.7079L25.4326 83.6653L27.0808 83.3848L27.7092 81.8355L24.9292 80.7079ZM15 279.288V276.288V279.288ZM81.1112 279.288V282.288V279.288ZM70.9341 80.6668L68.1936 81.8873L68.8537 83.3695L70.4555 83.6283L70.9341 80.6668ZM59.7193 9.0219L59.4129 6.03759L56.4381 6.34301L56.734 9.31869L59.7193 9.0219ZM34.4382 4.52288C34.4382 3.68182 35.1201 3 35.9611 3V-3C31.8063 -3 28.4382 0.368107 28.4382 4.52288H34.4382ZM35.9611 6.04576C35.1201 6.04576 34.4382 5.36394 34.4382 4.52288H28.4382C28.4382 8.67765 31.8063 12.0458 35.9611 12.0458V6.04576ZM36.3359 6.04576L35.9611 6.04576V12.0458H36.3359V6.04576ZM27.7092 81.8355C28.938 78.806 30.1444 73.608 31.2883 67.5533C32.4488 61.4111 33.5915 54.1208 34.6431 46.7399C36.7469 31.9737 38.5014 16.7373 39.3176 9.37638L33.3542 8.71514C32.5404 16.0538 30.7939 31.2186 28.7031 45.8936C27.6573 53.2333 26.5292 60.4237 25.3926 66.4394C24.2395 72.5427 23.1227 77.1799 22.1491 79.5803L27.7092 81.8355ZM3 110.281C3 96.9279 12.6965 85.8335 25.4326 83.6653L24.4257 77.7504C8.85442 80.4013 -3 93.9538 -3 110.281H3ZM3 264.288L3 110.281H-3L-3 264.288H3ZM15 276.288C8.37257 276.288 3 270.915 3 264.288H-3C-3 274.229 5.05886 282.288 15 282.288L15 276.288ZM81.1112 276.288L15 276.288L15 282.288L81.1112 282.288L81.1112 276.288ZM93.1112 264.288C93.1112 270.915 87.7386 276.288 81.1112 276.288V282.288C91.0523 282.288 99.1112 274.229 99.1112 264.288H93.1112ZM93.1112 110.281L93.1112 264.288H99.1112L99.1112 110.281H93.1112ZM70.4555 83.6283C83.3011 85.7042 93.1112 96.8499 93.1112 110.281H99.1112C99.1112 93.8588 87.1183 80.2433 71.4127 77.7052L70.4555 83.6283ZM56.734 9.31869C57.4638 16.6595 59.0536 31.878 61.0735 46.6439C62.0831 54.0243 63.2044 61.323 64.3846 67.4822C65.5461 73.5435 66.8164 78.795 68.1936 81.8873L73.6746 79.4462C72.6155 77.0682 71.4479 72.461 70.2774 66.353C69.1257 60.343 68.021 53.1621 67.0181 45.8307C65.013 31.173 63.4317 16.0393 62.7045 8.72511L56.734 9.31869ZM60.7747 4.52288C60.7747 5.30893 60.1768 5.95916 59.4129 6.03759L60.0257 12.0062C63.8183 11.6168 66.7747 8.41701 66.7747 4.52288H60.7747ZM59.2518 3C60.0929 3 60.7747 3.68182 60.7747 4.52288H66.7747C66.7747 0.368107 63.4066 -3 59.2518 -3V3ZM35.9611 3L59.2518 3V-3L35.9611 -3V3Z"
                    fill="black"
                    mask="url(#path-5-inside-1_60_2)"
                    />
                </g>
            </motion.g>
            <defs>
            <linearGradient
                id="paint0_linear_60_2"
                x1={48.0556}
                y1={0}
                x2={48.0556}
                y2={279.288}
                gradientUnits="userSpaceOnUse"
            >
                <stop stopColor="#66C80F" />
                <stop offset={0.791667} stopColor="#166107" />
            </linearGradient>
            </defs>
        </svg>
    )
}

export default BottleSvg;
  
